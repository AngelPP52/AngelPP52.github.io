(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{457:function(s,e,a){s.exports=a.p+"assets/img/sync.92c9ac74.png"},458:function(s,e,a){s.exports=a.p+"assets/img/cmd-spread.02194cf0.png"},459:function(s,e,a){s.exports=a.p+"assets/img/psync1.f847730b.png"},460:function(s,e,a){s.exports=a.p+"assets/img/offset.8da166a6.png"},461:function(s,e,a){s.exports=a.p+"assets/img/FIFO.c3796bd3.png"},544:function(s,e,a){"use strict";a.r(e);var n=a(4),t=Object(n.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"旧版复制功能概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#旧版复制功能概述"}},[s._v("#")]),s._v(" 旧版复制功能概述")]),s._v(" "),n("p",[s._v("复制是什么？")]),s._v(" "),n("ul",[n("li",[s._v("复制是指一个服务器去复制另一个服务器。复制可以使双方数据库保存相同的数据，也就是我们常说的“数据库状态一致”。其中被复制的服务器为主服务器，复制主服务器的为从服务器。")]),s._v(" "),n("li",[s._v("其中旧版复制存在两个阶段，一个是SYNC阶段，另一个是命令传播阶段。")])]),s._v(" "),n("h3",{attrs:{id:"sync及其工作流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#sync及其工作流程"}},[s._v("#")]),s._v(" SYNC及其工作流程")]),s._v(" "),n("p",[s._v("SYNC是什么？")]),s._v(" "),n("ul",[n("li",[s._v("SYNC是指将从服务器数据库状态更新至主服务器当前所处的数据库状态的操作。")])]),s._v(" "),n("p",[s._v("SYNC工作流程如下：\n"),n("img",{attrs:{src:a(457),alt:""}})]),s._v(" "),n("ol",[n("li",[s._v("从服务器向主服务器发送SYNC命令；")]),s._v(" "),n("li",[s._v("主服务器执行BGSAVE，后台生成RDB文件，并用缓冲区记录从现在开始执行的写命令；")]),s._v(" "),n("li",[s._v("将RDB文件发送给从服务器，从服务器载入RDB文件；")]),s._v(" "),n("li",[s._v("主服务器将记录在缓冲区的写命令发送给从服务器，从服务器执行命令。")])]),s._v(" "),n("h3",{attrs:{id:"命令传播"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#命令传播"}},[s._v("#")]),s._v(" 命令传播")]),s._v(" "),n("p",[s._v("命令传播什么？")]),s._v(" "),n("ul",[n("li",[s._v("命令传播是当主服务器的数据库状态被修改后，让主从服务器重新回到数据库状态一致。")])]),s._v(" "),n("p",[s._v("命令传播工作流程如下：\n"),n("img",{attrs:{src:a(458),alt:""}})]),s._v(" "),n("p",[s._v("当SYNC工作完成后，为了继续保持数据库状态一致，就需要命令传播。")]),s._v(" "),n("h2",{attrs:{id:"一次完整的旧版复制过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一次完整的旧版复制过程"}},[s._v("#")]),s._v(" 一次完整的旧版复制过程")]),s._v(" "),n("h3",{attrs:{id:"前期准备工作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前期准备工作"}},[s._v("#")]),s._v(" 前期准备工作")]),s._v(" "),n("ul",[n("li",[s._v("1、下载镜像，并运行容器")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker pull redis:2.6 //下载redis镜像。\ndocker run -itd --name redis-master -p 6379:6379 redis:2.6 //运行容器，启动主服务器\ndocker run -itd --name redis-slave -p 6380:6379 redis:2.6 //运行容器，启动从服务器\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("2、docker上redis-master、redis-slave的cli分别执行以下命令观察命令日志")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("redis-cli monitor //观察命令日志\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("3、终端运行命令观察redis运行日志")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker logs -f redis-master //查看redis-master运行日志\ndocker logs -f redis-slave //查看redis-master运行日志\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("4、数据初始化，在主服务器中执行以下命令")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("set key1 value1\nset key2 value2\nset key3 value3\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("5、获取redis-master的IP地址")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker inspect redis-master //获取容器的元数据。需要查看redis服务的IP地址\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"建立主从关系"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#建立主从关系"}},[s._v("#")]),s._v(" 建立主从关系")]),s._v(" "),n("ul",[n("li",[s._v("1、redis-slave执行以下命令")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("slaveof 172.17.0.4 6379 //成为某个服务器的从服务器\nslaveof no one //不执行该命令，取消该服务器的从属性\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("2、从服务器运行情况\n"),n("ul",[n("li",[s._v("从运行日志中我们可以看到执行了SYNC，并且从master中获取到59byte的数据，并将DB加载到内存中")]),s._v(" "),n("li",[s._v("从命令日志中我们看到，不断有PING命令，这是心跳检测")])])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('[1] 16 Dec 06:10:54.626 * SLAVE OF 172.17.0.2:6379 enabled (user request)\n[1] 16 Dec 06:10:55.637 * Connecting to MASTER 172.17.0.2:6379\n[1] 16 Dec 06:10:55.639 * MASTER <-> SLAVE sync started\n[1] 16 Dec 06:10:55.639 * Non blocking connect for SYNC fired the event.\n[1] 16 Dec 06:10:55.639 * Master replied to PING, replication can continue...\n[1] 16 Dec 06:10:55.738 * MASTER <-> SLAVE sync: receiving 59 bytes from master\n[1] 16 Dec 06:10:55.738 * MASTER <-> SLAVE sync: Loading DB in memory\n[1] 16 Dec 06:10:55.739 * MASTER <-> SLAVE sync: Finished with success\n---\n1608099054.626460 [0 127.0.0.1:36920] "slaveof" "172.17.0.2" "6379"\n1608099060.799684 [0 172.17.0.2:6379] "PING"\n1608099070.926835 [0 172.17.0.2:6379] "PING"\n……\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("ul",[n("li",[s._v("3、主服务器运行情况\n"),n("ul",[n("li",[s._v("从运行日志中，我们看出因为SYNC执行了BGSAVE，并且同步成功")]),s._v(" "),n("li",[s._v("从命令日志中，我们看到除了SYNC命令之前有个REPLCONF，这是告诉主服务器从服务器的监听端口号")])])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('[1] 16 Dec 06:10:55.640 * Slave ask for synchronization\n[1] 16 Dec 06:10:55.640 * Starting BGSAVE for SYNC\n[1] 16 Dec 06:10:55.640 * Background saving started by pid 26\n[26] 16 Dec 06:10:55.642 * DB saved on disk\n[26] 16 Dec 06:10:55.643 * RDB: 0 MB of memory used by copy-on-write\n[1] 16 Dec 06:10:55.737 * Background saving terminated with success\n[1] 16 Dec 06:10:55.738 * Synchronization with slave succeeded\n---\n1608099055.639657 [0 172.17.0.3:34294] "PING"\n1608099055.640046 [0 172.17.0.3:34294] "REPLCONF" "listening-port" "6379"\n1608099055.640378 [0 172.17.0.3:34294] "SYNC"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("ul",[n("li",[s._v("4、建立主从关系后\n"),n("ul",[n("li",[s._v("主服务器执行以下命令后，我们发现主服务器执行的命令传播到了从服务器")])])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("主服务器执行：\nset key4 value4\nset key5 value5\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('从服务器日志：\n1608100196.776754 [0 172.17.0.2:6379] "set" "key4" "value4"\n1608100199.368080 [0 172.17.0.2:6379] "set" "key5" "value5"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("ul",[n("li",[s._v("5、断开连接后重新连接\n"),n("ul",[n("li",[s._v("根据日志，我们发现日志跟初次连接几乎一致，也就是说还是使用了RDB")])])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker network disconnect bridge redis-slave-26 //从服务器断开网络\n日志如下：\n[1] 16 Dec 12:11:16.934 * Connecting to MASTER 172.17.0.2:6379\n[1] 16 Dec 12:11:16.934 # Unable to connect to MASTER: Network is unreachable\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("主服务器执行：\nset key6 value6\nset key7 value7\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker network connect bridge redis-slave-26 //从服务器连接网络\n重新连接后，日志同初次连接\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"存在的缺陷及解决方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#存在的缺陷及解决方法"}},[s._v("#")]),s._v(" 存在的缺陷及解决方法")]),s._v(" "),n("p",[s._v("在旧版复制一次完整的复制过程中，我们可以知道SYNC命令是一个非常耗费资源的操作：")]),s._v(" "),n("ul",[n("li",[s._v("BGSAVE命令需要生成RDB文件，耗费大量CPU、内存和磁盘I/O资源；")]),s._v(" "),n("li",[s._v("将RDB文件发送给从服务器，又需要耗费大量的网络资源，同时，还影响命令响应时长；")]),s._v(" "),n("li",[s._v("从服务器需要载入RDB文件，阻塞而无法处理命令请求。")])]),s._v(" "),n("p",[s._v("我们知道，在断线重连时，只需要执行"),n("code",[s._v("set key6 value6")]),s._v("，"),n("code",[s._v("set key6 value6")]),s._v("也就是同步在网络断开期间缺失的数据即可。")]),s._v(" "),n("p",[s._v("新版复制PSYNC，就做了这样的事情，从而减少耗费资源的操作。")]),s._v(" "),n("h2",{attrs:{id:"新版复制功能"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#新版复制功能"}},[s._v("#")]),s._v(" 新版复制功能")]),s._v(" "),n("h3",{attrs:{id:"psync的工作流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#psync的工作流程"}},[s._v("#")]),s._v(" PSYNC的工作流程")]),s._v(" "),n("p",[s._v("相对于SYNC，PSYNC区分复制时的两种情况：")]),s._v(" "),n("ul",[n("li",[s._v("完整重同步。类似于SYNC")]),s._v(" "),n("li",[s._v("部分重同步。用于处理断线后重新复制的情况。")])]),s._v(" "),n("p",[s._v("其工作流程如下：")]),s._v(" "),n("ol",[n("li",[s._v("从服务器向主服务器发送PSYNC命令，是第一次复制发送"),n("code",[s._v("PSYNC ？-1")]),s._v("；否则发送"),n("code",[s._v("PSYNC <runid> <offset>")])]),s._v(" "),n("li",[s._v("如果主服务器接收到"),n("code",[s._v("PSYNC ？-1")]),s._v("，则进行步骤4；")]),s._v(" "),n("li",[s._v("如果主服务器接收到"),n("code",[s._v("PSYNC <runid> <offset>")]),s._v("，判断是否可以进行部分重同步，可以则执行步骤5，不可以则执行步骤4；")]),s._v(" "),n("li",[s._v("主服务器返回"),n("code",[s._v("+FULLRESYNC <runid> <offset>")]),s._v("，执行完整重同步；")]),s._v(" "),n("li",[s._v("返回"),n("code",[s._v("+CONTINUE")]),s._v("，执行部分重同步，发送断线期间主服务器执行的写命令。")])]),s._v(" "),n("p",[s._v("下图展示了"),n("em",[s._v("部分重同步")]),s._v(" 的过程：\n"),n("img",{attrs:{src:a(459),alt:""}})]),s._v(" "),n("h3",{attrs:{id:"psync中部分重同步的实现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#psync中部分重同步的实现"}},[s._v("#")]),s._v(" PSYNC中部分重同步的实现")]),s._v(" "),n("p",[s._v("在了解PSYNC的工作流程之后，你是否会存在下面的疑问？")]),s._v(" "),n("ul",[n("li",[s._v("从服务器如何知道是第一次复制？")]),s._v(" "),n("li",[s._v("主服务器如何判断是否可以进行部分重同步？")]),s._v(" "),n("li",[s._v("runid和offset是什么？")])]),s._v(" "),n("p",[s._v("这就涉及到部分重同步的实现了。主要包含三部分：")]),s._v(" "),n("ul",[n("li",[s._v("主服务器的复制偏移量和从服务器的复制偏移量。")]),s._v(" "),n("li",[s._v("主服务器的复制积压缓冲区。")]),s._v(" "),n("li",[s._v("服务器的运行ID。")])]),s._v(" "),n("h4",{attrs:{id:"复制偏移量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#复制偏移量"}},[s._v("#")]),s._v(" 复制偏移量")]),s._v(" "),n("p",[s._v("复制偏移量在复制过程中是如何维护的？")]),s._v(" "),n("ul",[n("li",[s._v("主服务器每次向从服务器传播N个字节数据时，主服务器的偏移量+N")]),s._v(" "),n("li",[s._v("从服务器接收到N个字节数据时，从服务器的偏移量+N\n如下图所示：\n"),n("img",{attrs:{src:a(460),alt:""}})])]),s._v(" "),n("p",[s._v("我们可以很容易的得出，复制偏移量是用来确认主从服务器是否处于一致状态。")]),s._v(" "),n("p",[s._v("主从服务器的复制偏移量相同，那么主从则处于一致状态，反之则不一致。参照上图，假如一台slave断线，那么它的偏移量就不再是1000。")]),s._v(" "),n("h4",{attrs:{id:"复制积压缓冲区"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#复制积压缓冲区"}},[s._v("#")]),s._v(" 复制积压缓冲区")]),s._v(" "),n("p",[s._v("复制积压缓冲区是由主服务器维护的一个"),n("em",[s._v("固定长度先进先出队列")]),s._v("。如下图所示：\n"),n("img",{attrs:{src:a(461),alt:""}})]),s._v(" "),n("p",[s._v("当主服务器进行命令传播时，不仅将写命令发送给从服务器，还会将写命令入队到复制积压缓冲区。")]),s._v(" "),n("p",[s._v("上文提到，主服务器需要判断是否可以进行部分重同步，从服务器会将自己的offset发送给从服务器：")]),s._v(" "),n("ul",[n("li",[s._v("如果offset之后的数据仍然在复制积压缓冲区中，那么进行部分重同步")]),s._v(" "),n("li",[s._v("反之则进行完整重同步")])]),s._v(" "),n("p",[s._v("一般来说复制积压缓冲区的大小设置为2 * 从服务器断线重连的平均时间 * 主服务器平均每秒产生的写命令数据量。\n这样设置可以尽可能的避免完整重同步。")]),s._v(" "),n("h4",{attrs:{id:"服务器运行id"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#服务器运行id"}},[s._v("#")]),s._v(" 服务器运行ID")]),s._v(" "),n("p",[s._v("每个Redis服务器在启动时都会生成自己的runid。并参与部分重同步：")]),s._v(" "),n("ul",[n("li",[s._v("初次复制时，主服务器将自己的runid发送给从服务器，从服务器保存起来。")]),s._v(" "),n("li",[s._v("如果从服务器保存的runid和当前连接的主服务器的runid一致，那么可以进行部分重同步。")]),s._v(" "),n("li",[s._v("反之，是连接的是新的主服务器，则进行完整重同步。")])]),s._v(" "),n("h2",{attrs:{id:"一次完整的新版复制过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一次完整的新版复制过程"}},[s._v("#")]),s._v(" 一次完整的新版复制过程")]),s._v(" "),n("p",[s._v("前期准备工作参考旧版复制，差别在于，这次我们使用Redis 2.8版本。")]),s._v(" "),n("ul",[n("li",[s._v("1、redis-slave执行以下命令")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("slaveof 172.17.0.4 6379 //成为某个服务器的从服务器\nslaveof no one //不执行该命令，取消该服务器的从属性\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("2、从服务器运行情况\n"),n("ul",[n("li",[s._v("相比于旧版复制，我们可以看到日志里面告诉我们无法进行部分重同步，是因为第一次复制，然后开启了完整重同步")])])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('[1] 17 Dec 07:18:59.687 * SLAVE OF 172.17.0.4:6379 enabled (user request from \'id=3 addr=127.0.0.1:37520 fd=7 name= age=537 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=32768 obl=0 oll=0 omem=0 events=r cmd=slaveof\')\n[1] 17 Dec 07:18:59.775 * Connecting to MASTER 172.17.0.4:6379\n[1] 17 Dec 07:18:59.775 * MASTER <-> SLAVE sync started\n[1] 17 Dec 07:18:59.775 * Non blocking connect for SYNC fired the event.\n[1] 17 Dec 07:18:59.776 * Master replied to PING, replication can continue...\n[1] 17 Dec 07:18:59.776 * Partial resynchronization not possible (no cached master)\n[1] 17 Dec 07:18:59.778 * Full resync from master: 3ca26d6892dff2437685123d32ea28b047624cfc:1067\n[1] 17 Dec 07:18:59.878 * MASTER <-> SLAVE sync: receiving 59 bytes from master\n[1] 17 Dec 07:18:59.878 * MASTER <-> SLAVE sync: Flushing old data\n[1] 17 Dec 07:18:59.879 * MASTER <-> SLAVE sync: Loading DB in memory\n[1] 17 Dec 07:18:59.879 * MASTER <-> SLAVE sync: Finished with success\n---\n1608189541.194820 [0 172.17.0.4:6379] "PING"\n1608189551.338034 [0 172.17.0.4:6379] "PING"\n……\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("ul",[n("li",[s._v("3、主服务器运行情况\n"),n("ul",[n("li",[s._v("它告诉我们进行了完整重同步，使用了SYNC。")])])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('[1] 17 Dec 07:18:59.777 * Slave 172.17.0.2:6379 asks for synchronization\n[1] 17 Dec 07:18:59.777 * Full resync requested by slave 172.17.0.2:6379\n[1] 17 Dec 07:18:59.777 * Starting BGSAVE for SYNC with target: disk\n[1] 17 Dec 07:18:59.777 * Background saving started by pid 30\n[30] 17 Dec 07:18:59.780 * DB saved on disk\n[30] 17 Dec 07:18:59.780 * RDB: 0 MB of memory used by copy-on-write\n[1] 17 Dec 07:18:59.877 * Background saving terminated with success\n[1] 17 Dec 07:18:59.878 * Synchronization with slave 172.17.0.2:6379 succeeded\n---\n1608189539.775970 [0 172.17.0.2:38814] "PING"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("ul",[n("li",[s._v("4、断开连接后重新连接\n"),n("ul",[n("li",[s._v("本次不再进行命令传播，直接尝试断线重连")]),s._v(" "),n("li",[s._v("我们可以看到主从双方进行了部分重同步，并且offset=1992，这次同步了247byte的数据")])])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker network disconnect bridge redis-slave-26 //从服务器断开网络\n日志如下：\n[1] 17 Dec 07:31:02.671 # MASTER timeout: no data nor PING received...\n[1] 17 Dec 07:31:02.671 # Connection with master lost.\n[1] 17 Dec 07:31:02.671 * Caching the disconnected master state.\n[1] 17 Dec 07:31:02.672 * Connecting to MASTER 172.17.0.4:6379\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("主服务器执行：\nset key4 value5\nset key5 value5\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker network connect bridge redis-slave-26 //从服务器连接网络\n从服务器日志：\n[1] 17 Dec 07:31:53.465 * MASTER <-> SLAVE sync started\n[1] 17 Dec 07:31:53.466 * Non blocking connect for SYNC fired the event.\n[1] 17 Dec 07:31:53.466 * Master replied to PING, replication can continue...\n[1] 17 Dec 07:31:53.467 * Trying a partial resynchronization (request 3ca26d6892dff2437685123d32ea28b047624cfc:1992).\n[1] 17 Dec 07:31:53.468 * Successful partial resynchronization with master.\n[1] 17 Dec 07:31:53.468 * MASTER <-> SLAVE sync: Master accepted a Partial Resynchronization.\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("主服务器日志：\nDisconnecting timedout slave: 172.17.0.2:6379\n[1] 17 Dec 07:31:07.132 # Connection with slave 172.17.0.2:6379 lost.\n[1] 17 Dec 07:31:53.468 * Slave 172.17.0.2:6379 asks for synchronization\n[1] 17 Dec 07:31:53.468 * Partial resynchronization request from 172.17.0.2:6379 accepted. Sending 247 bytes of backlog starting from offset 1992.\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("ul",[n("li",[s._v("5、主从服务器的info Replication\n"),n("ul",[n("li",[s._v("使用info Replication可以查看主从相关信息，这里我们只关注offset(/slave_repl_offset)")]),s._v(" "),n("li",[s._v("从服务器断线后，主服务器执行了写命令之后，我们可以看到主从的offset不一致")]),s._v(" "),n("li",[s._v("断线重连后，我们可以发现主从服务器的offset已经一致了")])])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("role:slave\nmaster_host:172.17.0.4\nmaster_port:6379\nmaster_link_status:up\nmaster_last_io_seconds_ago:9\nmaster_sync_in_progress:0\nslave_repl_offset:2378\nslave_priority:100\nslave_read_only:1\nconnected_slaves:0\nmaster_repl_offset:0\nrepl_backlog_active:0\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:0\nrepl_backlog_histlen:0\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h2",{attrs:{id:"复制功能在实践中遇到的问题，原因分析及解决办法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#复制功能在实践中遇到的问题，原因分析及解决办法"}},[s._v("#")]),s._v(" 复制功能在实践中遇到的问题，原因分析及解决办法")]),s._v(" "),n("h3",{attrs:{id:"问题描述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#问题描述"}},[s._v("#")]),s._v(" 问题描述")]),s._v(" "),n("p",[s._v("我们知道服务器之间建立主从关系后，写命令是通过主服务器传播给从服务器的。那么过期键的删除呢？")]),s._v(" "),n("p",[s._v("Redis过期键的删除策略由两部分组成，一个是惰性删除，一个是定期删除，只有真正执行删除命令时，过期键才会被删除，但是在从服务器中，一个键已经过期了，却能够获取到值。")]),s._v(" "),n("h3",{attrs:{id:"问题复现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#问题复现"}},[s._v("#")]),s._v(" 问题复现")]),s._v(" "),n("ul",[n("li",[s._v("1、参考一次完整的复制功能建立主从服务器。此时数据库状态如下：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('127.0.0.1:6379> keys *\n1) "key3"\n2) "key2"\n3) "key1"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ul",[n("li",[s._v("2、主服务器中执行以下命令：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("expire key1 10 //设置key1键的过期时间为10s\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("3、在expire命令传播到从服务器之后，过期时间结束之前执行以下命令：\n"),n("ul",[n("li",[s._v("断开了从服务器的网络连接，是因为过期键存在定期删除，这个定期任务默认是100ms执行一次，渐进随机的扫描键值对。我们的数据库中键值对很少，所以每100ms都会删除过期键，就达不到问题复现的条件了。")])])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("docker network disconnect bridge redis-slave-28 //断开从服务器的网络连接\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("4、过期时间达到后，执行以下命令：")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('主服务器：\n127.0.0.1:6379> keys *\n1) "key3"\n2) "key2"\n127.0.0.1:6379> get key1\n(nil)\n从服务器：\n127.0.0.1:6379> keys *\n1) "key3"\n2) "key2"\n127.0.0.1:6379> get key1\n"value1"\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[s._v("我们发现主服务器和从服务器用keys命令都没有key1键，但是get key1时，从服务器却能获取到值。")]),s._v(" "),n("h3",{attrs:{id:"原因分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#原因分析"}},[s._v("#")]),s._v(" 原因分析")]),s._v(" "),n("p",[s._v("显而易见，问题出在从服务器的get命令上。")]),s._v(" "),n("ul",[n("li",[s._v("我们先来看一下Redis中删除过期键的相关源码\n"),n("ul",[n("li",[s._v("从代码中我们可以看出，在从服务器中redis是不会删除过期键的")]),s._v(" "),n("li",[s._v("如果是主服务器，才会删除过期键，并将删除操作传播给从服务器")])])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('int expireIfNeeded(redisDb *db, robj *key) {\n    long long when = getExpire(db,key);\n\n    if (when < 0) return 0; /* No expire for this key */\n\n    /* Don\'t expire anything while loading. It will be done later. */\n    if (server.loading) return 0;\n\n    /* If we are running in the context of a slave, return ASAP:\n     * the slave key expiration is controlled by the master that will\n     * send us synthesized DEL operations for expired keys.\n     *\n     * Still we try to return the right information to the caller, \n     * that is, 0 if we think the key should be still valid, 1 if\n     * we think the key is expired at this time. */\n    if (server.masterhost != NULL) {\n        return mstime() > when;\n    }\n\n    /* Return when this key has not expired */\n    if (mstime() <= when) return 0;\n\n    /* Delete the key */\n    server.stat_expiredkeys++;\n    propagateExpire(db,key);\n    notifyKeyspaceEvent(REDIS_NOTIFY_EXPIRED,\n        "expired",key,db->id);\n    return dbDelete(db,key);\n}\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("ul",[n("li",[s._v("再来看看get命令的相关源码\n"),n("ul",[n("li",[s._v("我们看到，是先执行了expireIfNeeded方法，然后在lookupKey来获取值的。")])])])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("robj *lookupKeyRead(redisDb *db, robj *key) {\n    robj *val;\n\n    expireIfNeeded(db,key);\n    val = lookupKey(db,key);\n    if (val == NULL)\n        server.stat_keyspace_misses++;\n    else\n        server.stat_keyspace_hits++;\n    return val;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("ul",[n("li",[s._v("综上所述，在主服务器中，获取过期键，会删除过期键，并返回NULL，而在从服务器中，并不会删除，反而返回了过期的值。")])]),s._v(" "),n("h3",{attrs:{id:"解决办法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决办法"}},[s._v("#")]),s._v(" 解决办法")]),s._v(" "),n("p",[s._v("上述问题，是Redis自身代码问题所导致的，存在有两种解决办法：")]),s._v(" "),n("ul",[n("li",[s._v("1、可以理解为这是过期键的删除操作传播不及时导致的，可以不断做一个扫库操作。\n"),n("ul",[n("li",[s._v("显然，这样会影响redis的性能，同时仍然存在一定时间的延迟。")])])]),s._v(" "),n("li",[s._v("2、升级Redis版本到3.2以上。")])]),s._v(" "),n("p",[s._v("我们来看看Redis3.2相关源码：")]),s._v(" "),n("ul",[n("li",[s._v("可以看到，这次lookupKeyReadWithFlags中对过期键进行了判断。如果调用者不是主服务器，并且命令是只读命令，那么返回NULL")])]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("/* Like lookupKeyReadWithFlags(), but does not use any flag, which is the\n * common case. */\nrobj *lookupKeyRead(redisDb *db, robj *key) {\n    return lookupKeyReadWithFlags(db,key,LOOKUP_NONE);\n}\n\nrobj *lookupKeyReadWithFlags(redisDb *db, robj *key, int flags) {\n    robj *val;\n\n    if (expireIfNeeded(db,key) == 1) {\n        /* Key expired. If we are in the context of a master, expireIfNeeded()\n         * returns 0 only when the key does not exist at all, so it's save\n         * to return NULL ASAP. */\n        if (server.masterhost == NULL) return NULL;\n\n        /* However if we are in the context of a slave, expireIfNeeded() will\n         * not really try to expire the key, it only returns information\n         * about the \"logical\" status of the key: key expiring is up to the\n         * master in order to have a consistent view of master's data set.\n         *\n         * However, if the command caller is not the master, and as additional\n         * safety measure, the command invoked is a read-only command, we can\n         * safely return NULL here, and provide a more consistent behavior\n         * to clients accessign expired values in a read-only fashion, that\n         * will say the key as non exisitng.\n         *\n         * Notably this covers GETs when slaves are used to scale reads. */\n        if (server.current_client &&\n            server.current_client != server.master &&\n            server.current_client->cmd &&\n            server.current_client->cmd->flags & CMD_READONLY)\n        {\n            return NULL;\n        }\n    }\n    val = lookupKey(db,key,flags);\n    if (val == NULL)\n        server.stat_keyspace_misses++;\n    else\n        server.stat_keyspace_hits++;\n    return val;\n}\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br")])]),n("h2",{attrs:{id:"最后"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#最后"}},[s._v("#")]),s._v(" 最后")]),s._v(" "),n("p",[s._v("我不能保证每一个地方都是正确的，但是每一句话都经过了认真的推敲，仔细的斟酌。")]),s._v(" "),n("p",[s._v("本人才疏学浅，如有遗漏或是错误，还望告知。")])])}),[],!1,null,null,null);e.default=t.exports}}]);